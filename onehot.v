// Implement one-hot state machine